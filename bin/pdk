#!/bin/bash

set -e
set -x

PDK_DIRECTORY="$(realpath $(dirname $0)/..)"
echo "Running PDK from ${PDK_DIRECTORY}..."

COMMAND=$1
if [ -z "${COMMAND}" ]; then
  echo "No command to execute given."
  exit 1
fi

COMMAND_FILE=${PDK_DIRECTORY}/scripts/${COMMAND}.py
if [ ! -f "${COMMAND_FILE}" ]; then
  echo "Command ${COMMAND} does not exist."
  exit 1
fi

VENV_DIRECTORY=${PDK_DIRECTORY}/venv
if [ ! -d "${VENV_DIRECTORY}" ]; then
  echo "venv not found, creating one..."
  python3 -m venv ${VENV_DIRECTORY}
  pip install -r ${PDK_DIRECTORY}/requirements.txt
else
  echo "Using venv from ${VENV_DIRECTORY}"
fi
source ${VENV_DIRECTORY}/bin/activate

ARGUMENTS=${@:2}

python3 ${COMMAND_FILE} ${ARGUMENTS}